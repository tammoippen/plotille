<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Plotille Brython Test</title>
    <script type="text/javascript" src="brython.js"></script>
    <script type="text/javascript" src="brython_stdlib.js"></script>
    <script type="module">
        // Load AnsiUp as ES6 module
        import { AnsiUp } from './ansi_up.js';

        // Create instance and expose to global scope
        window.ansiUpConverter = new AnsiUp();
    </script>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background-color: #0a0a0a;
            color: #ffb000;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: #ffd000;
            text-shadow: 0 0 8px rgba(255, 176, 0, 0.4);
        }

        .terminal-output {
            background-color: #1a1200;
            border: 2px solid #cc8800;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            box-shadow: 0 0 20px rgba(255, 176, 0, 0.4);
            white-space: pre;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
        }

        .code-block {
            background-color: #1a1200;
            border: 1px solid #cc8800;
            border-radius: 4px;
            padding: 1rem;
            margin: 1rem 0;
            overflow-x: auto;
        }

        button {
            background-color: #cc8800;
            color: #0a0a0a;
            border: 1px solid #ffb000;
            padding: 0.5rem 1rem;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            cursor: pointer;
            margin: 1rem 0;
        }

        button:hover {
            background-color: #ffb000;
            box-shadow: 0 0 10px rgba(255, 176, 0, 0.4);
        }

        .status {
            padding: 0.5rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .status.error {
            background-color: #3a0000;
            border: 1px solid #ff0000;
            color: #ff6666;
        }

        .status.success {
            background-color: #003a00;
            border: 1px solid #00ff00;
            color: #66ff66;
        }
    </style>
</head>
<body onload="brython()">
    <h1>Plotille Brython Compatibility Test</h1>

    <p>This page tests whether plotille can run in the browser using Brython (Python in the browser).</p>

    <h2>Test: Olympic Rings Example</h2>
    <div class="code-block">
        <code>
import plotille
import plotille.data as plt_data

fig = plotille.Figure()
fig.width = 50
fig.height = 20

fig.set_x_limits(min_=0, max_=600)
fig.set_y_limits(min_=0, max_=500)

centers = []
centers.append([250, 200, "blue"])
centers.append([375, 200, "white"])
centers.append([500, 200, "red"])
centers.append([310, 250, "yellow"])
centers.append([435, 250, "green"])

for ring in centers:
    X, Y = plt_data.circle(x_center=ring[0], y_center=500 - ring[1], radius=50)
    fig.plot(X, Y, lc=ring[2])

print(fig.show(legend=False))
        </code>
    </div>

    <button id="run-btn">Run Example</button>

    <div id="status"></div>

    <h3>Output:</h3>
    <div id="output" class="terminal-output"></div>

    <script type="text/python">
from browser import document, html, window
import sys
import traceback

def run_example(ev):
    """Run the olympic rings example and display output."""
    output_div = document["output"]
    status_div = document["status"]

    # Clear previous output
    output_div.html = ""
    status_div.clear()

    try:
        # Import plotille
        status_div <= html.DIV("Importing plotille...", Class="status")
        import plotille
        import plotille.data as plt_data

        status_div.clear()
        status_div <= html.DIV("✓ Import successful! Running example...", Class="status success")

        # Capture stdout
        output_lines = []

        class OutputCapture:
            def write(self, text):
                output_lines.append(text)
            def flush(self):
                pass
            def isatty(self):
                return True  # Pretend we're a TTY to get colors

        # Redirect stdout
        old_stdout = sys.stdout
        sys.stdout = OutputCapture()

        try:
            # Run the olympic rings example
            fig = plotille.Figure()
            fig.width = 50
            fig.height = 20

            fig.set_x_limits(min_=0, max_=600)
            fig.set_y_limits(min_=0, max_=500)

            centers = []
            centers.append([250, 200, "blue"])
            centers.append([375, 200, "white"])
            centers.append([500, 200, "red"])
            centers.append([310, 250, "yellow"])
            centers.append([435, 250, "green"])

            for ring in centers:
                X, Y = plt_data.circle(x_center=ring[0], y_center=500 - ring[1], radius=50)
                fig.plot(X, Y, lc=ring[2])

            print(fig.show(legend=False))
        finally:
            sys.stdout = old_stdout

        # Convert ANSI to HTML and display
        raw_output = ''.join(output_lines)
        html_output = window.ansiUpConverter.ansi_to_html(raw_output)
        output_div.innerHTML = html_output

        status_div.clear()
        status_div <= html.DIV("✓ Example completed successfully!", Class="status success")

    except Exception as e:
        status_div.clear()
        error_msg = f"✗ Error: {str(e)}\n\n{traceback.format_exc()}"
        status_div <= html.DIV(error_msg, Class="status error")
        output_div.text = "Example failed to run. See error above."

# Bind the button click event
document["run-btn"].bind("click", run_example)
    </script>
</body>
</html>
